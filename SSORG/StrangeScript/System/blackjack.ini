[script]
n0=alias get.card {
n1=  set %bj.val ""
n2=  set %bj.deal2 $rand(1,$lines($mircdirtext\BlackJack.txt))
n3=  set %bj.deal1 $read -nl $+ %bj.deal2 $mircdirtext\BlackJack.txt
n4=  if (%bj.deal1 == $null) { shuffle | bj.deal }
n5=  .write -dl $+ %bj.deal2 $mircdirtext\BlackJack.txt
n6=  if ($gettok(%bj.deal1,2,44) == Ace) { set %bj.val 1 }
n7=  elseif ($gettok(%bj.deal1,2,44) !isnum) { set %bj.val 10 }
n8=  else { set %bj.val $gettok(%bj.deal1,2,44) }
n9=  return %bj.val $+ , $+ $gettok(%bj.deal1,2,44) $+ , $+ $gettok(%bj.deal1,1,44)
n10=}
n11=alias ace.fix {
n12=  set %tmp2 $?!="Use Ace as 11"
n13=  if ($1 == DEALER) && (%tmp2 == $true) { set %bj.math.dealer %bj.math.dealer + 10 }
n14=  if ($1 == USER) && (%tmp2 == $true) { set %bj.math.user %bj.math.user + 10 }
n15=  drawtext -b @BlackJack 8 1 Arial 16 320 12 Dealer %bj.math.dealer
n16=  drawtext -b @BlackJack 8 1 Arial 16 75 12 You %bj.math.user $space $lines($mircdirtext\BlackJack.txt) cards left
n17=}
n18=alias bj.deal {
n19=  set %bj.math.dealer 0
n20=  set %bj.math.user 0
n21=  set %bj.hit.user 0
n22=  set %bj.round ON
n23=  ;dealer
n24=  get.card
n25=  set %bj.hand1 $result
n26=  set %bj.math1 $gettok(%bj.hand1,1,44)
n27=  get.card
n28=  set %bj.hand2 $result
n29=  set %bj.math2 $gettok(%bj.hand2,1,44)
n30=  set %bj.math.dealer $calc(%bj.math1 + %bj.math2)
n31=  set %hand2 %bj.math.dealer $+ , $+ $gettok(%bj.hand1,2,44) of $gettok(%bj.hand1,3,44) $+ , $+ $gettok(%bj.hand2,2,44) of $gettok(%bj.hand2,3,44)
n32=  ;you 
n33=  get.card
n34=  set %bj.hand1 $result
n35=  set %bj.math1 $gettok(%bj.hand1,1,44)
n36=  get.card
n37=  set %bj.hand2 $result
n38=  set %bj.math2 $gettok(%bj.hand2,1,44)
n39=  set %bj.math.user $calc(%bj.math1 + %bj.math2)
n40=  set %hand1 %bj.math.user $+ , $+ $gettok(%bj.hand1,2,44) of $gettok(%bj.hand1,3,44) $+ , $+ $gettok(%bj.hand2,2,44) of $gettok(%bj.hand2,3,44)
n41=  if (*Ace* iswm %hand2) { .timerAceD 1 1 ace.fix DEALER }
n42=  if (*Ace* iswm %hand1) { .timerAceU 1 1 ace.fix USER }
n43=  show.hand
n44=}
n45=alias show.hand {
n46=  bj.title
n47=  bj.back
n48=  drawline @blackjack 10 5 1 30 470 30
n49=  drawtext -b @BlackJack 8 1 Arial 16 75 12 You
n50=  drawtext -b @BlackJack 8 1 Arial 16 320 12 Dealer
n51=  drawtext -b @BlackJack 8 1 Arial 16 13 150 Dealer has...
n52=  drawtext -b @BlackJack 8 1 Arial 16 300 40 $gettok(%hand2,2,44)
n53=  drawtext -b @BlackJack 8 1 Arial 16 300 60 $gettok(%hand2,3,44)
n54=  drawtext -b @BlackJack 8 1 Arial 16 320 12 Dealer %bj.math.dealer
n55=  drawtext -b @BlackJack 8 1 Arial 16 13 150 You have.....
n56=  drawtext -b @BlackJack 8 1 Arial 16 55 40 $gettok(%hand1,2,44)
n57=  drawtext -b @BlackJack 8 1 Arial 16 55 60 $gettok(%hand1,3,44)
n58=  drawtext -b @BlackJack 8 1 Arial 16 75 12 You %bj.math.user $space $lines($mircdirtext\BlackJack.txt) cards left
n59=  if (%bj.math.dealer > 21) { bj.dealer.bust | halt }
n60=  if (%bj.math.dealer < 17) {
n61=    drawtext -b @BlackJack 8 1 Arial 16 13 150 Dealer Hits...
n62=    get.card
n63=    set %hand2 $result
n64=    if (*Ace* iswm %hand2) { .timerAceD 1 1 ace.fix DEALER }
n65=    set %bj.math.dealer $calc(%bj.math.dealer + $gettok(%hand2,1,44))
n66=    drawtext -b @BlackJack 8 1 Arial 16 300 80 $gettok(%hand2,2,44) of $gettok(%hand2,3,44)
n67=    drawtext -b @BlackJack 8 1 Arial 16 320 12 Dealer %bj.math.dealer
n68=  }
n69=  if (%bj.math.dealer > 21) { bj.dealer.bust | halt }
n70=  if (%bj.math.dealer < 17) {
n71=    drawtext -b @BlackJack 8 1 Arial 16 13 150 Dealer Hits...
n72=    get.card
n73=    set %hand2 $result
n74=    if (*Ace* iswm %hand2) { .timerAceD 1 1 ace.fix DEALER }
n75=    set %bj.math.dealer $calc(%bj.math.dealer + $gettok(%hand2,1,44))
n76=    drawtext -b @BlackJack 8 1 Arial 16 300 100 $gettok(%hand2,2,44) of $gettok(%hand2,3,44)
n77=    drawtext -b @BlackJack 8 1 Arial 16 320 12 Dealer %bj.math.dealer
n78=  }
n79=  if (%bj.math.dealer > 21) { bj.dealer.bust | halt }
n80=  if (%bj.math.dealer < 17) {
n81=    drawtext -b @BlackJack 8 1 Arial 16 13 150 Dealer Hits...
n82=    get.card
n83=    set %hand2 $result
n84=    if (*Ace* iswm %hand2) { .timerAceD 1 1 ace.fix DEALER }
n85=    set %bj.math.dealer $calc(%bj.math.dealer + $gettok(%hand2,1,44))
n86=    drawtext -b @BlackJack 8 1 Arial 16 300 120 $gettok(%hand2,2,44) of $gettok(%hand2,3,44)
n87=    drawtext -b @BlackJack 8 1 Arial 16 320 12 Dealer %bj.math.dealer
n88=  }
n89=  if (%bj.math.dealer > 21) { bj.dealer.bust | halt }
n90=  if (%bj.math.dealer == 21) { bj.user.bust }
n91=  if (%bj.math.user > %bj.math.dealer) { bj.dealer.bust | halt }
n92=  ;if (%bj.math.user > 21) { echo @BlackJack $sys Busted loser | set %bj.math.user 0 }
n93=}
n94=alias bj.dealer.bust {
n95=  .timerAceD OFF
n96=  .timerAceU OFF
n97=  set %bj.round OFF
n98=  set %bj.money $calc(%bj.money + %bj.bet)
n99=  if (%bj.money.bank != $null) { write -l $+ %bj.money.bank $textdir $+ slots.txt $me %bj.money }
n100=  bj.title
n101=  drawtext -pb @BlackJack 08 01 Arial 16 13 150 You Won!! play again (deal)
n102=}
n103=alias bj.user.bust {
n104=  .timerAceD OFF
n105=  .timerAceU OFF
n106=  set %bj.round OFF
n107=  set %bj.money $calc(%bj.money - %bj.bet)
n108=  if (%bj.money.bank != $null) { write -l $+ %bj.money.bank $textdir $+ slots.txt $me %bj.money }
n109=  bj.title
n110=  drawtext -pb @BlackJack 08 01 Arial 16 13 150 You Lost!! play again (deal)
n111=}
n112=alias bj.push {
n113=  set %bj.round OFF
n114=  bj.reply Push no losers here!! play again (deal)
n115=}
n116=alias blackjack {
n117=  if ($1 == OFF) { unset %bj* %hand* | if ($window(@BlackJack).x !== $null) { window -c @Blackjack } | $stecho Blackjack halted | halt }
n118=  $stecho Blackjack started
n119=  set %bj.money $read -s $+ $me $textdir $+ slots.txt
n120=  if (%bj.money == $null) { set %bj.money 100 }
n121=  set %bj.money.bank $readn
n122=  if (%bj.money.bank == $null) { set %bj.money.bank $lines($textdir $+ slots.txt) + 1 }
n123=  window -adek0op @Blackjack 1 1 480 240 @bj Arial 12
n124=  bj.back
n125=  bj.title
n126=  shuffle
n127=  bj.reply.delay Ready for bet.
n128=}
n129=on 1:INPUT:@BlackJack:{
n130=  if ($1 == bet) { if ($2 == $null) { bj.reply Usage is bet <amount> | halt }
n131=    if ($2 > %bj.money) { set %bj.bet 25 | bj.reply.delay For betting more than you have, you bet is limited to 25 loser | goto bj.out }
n132=    set %bj.bet $2
n133=    bj.reply Your bet is set at %bj.bet (type deal)
n134=    :bj.out
n135=    bj.title
n136=    halt
n137=  }
n138=  if ($1 == hit) {
n139=    if (%bj.round == OFF) { halt }
n140=    inc %bj.hit.user
n141=    get.card
n142=    set %bj.hit1 $result
n143=    set %bj.math.user %bj.math.user + $gettok(%bj.hit1,1,44)
n144=    if (%bj.math.user > 21) { 
n145=      drawtext -b @BlackJack 8 1 Arial 16 55 80 $gettok(%bj.hit1,2,44) of $gettok(%bj.hit1,3,44)
n146=      drawtext -b @BlackJack 8 1 Arial 16 75 12 You %bj.math.user $space $lines($mircdirtext\BlackJack.txt) cards left
n147=      bj.user.bust
n148=      halt
n149=    }
n150=    if (*Ace* iswm %bj.hit1) { .timerAceU 1 1 ace.fix USER }
n151=    if (%bj.hit.user == 1) {
n152=      drawtext -b @BlackJack 8 1 Arial 16 55 80 $gettok(%bj.hit1,2,44) of $gettok(%bj.hit1,3,44)
n153=      drawtext -b @BlackJack 8 1 Arial 16 75 12 You %bj.math.user $space $lines($mircdirtext\BlackJack.txt) cards left
n154=    }
n155=    if (%bj.math.user > %bj.math.dealer) { 
n156=      drawtext -b @BlackJack 8 1 Arial 16 55 100 $gettok(%bj.hit1,2,44) of $gettok(%bj.hit1,3,44)
n157=      drawtext -b @BlackJack 8 1 Arial 16 75 12 You %bj.math.user $space $lines($mircdirtext\BlackJack.txt) cards left
n158=      bj.dealer.bust
n159=      halt
n160=    }
n161=    if (%bj.hit.user == 2) {
n162=      drawtext -b @BlackJack 8 1 Arial 16 55 100 $gettok(%bj.hit1,2,44) of $gettok(%bj.hit1,3,44)
n163=      drawtext -b @BlackJack 8 1 Arial 16 75 12 You %bj.math.user $space $lines($mircdirtext\BlackJack.txt) cards left
n164=    }
n165=    if (%bj.math.user > %bj.math.dealer) { 
n166=      drawtext -b @BlackJack 8 1 Arial 16 55 100 $gettok(%bj.hit1,2,44) of $gettok(%bj.hit1,3,44)
n167=      drawtext -b @BlackJack 8 1 Arial 16 75 12 You %bj.math.user $space $lines($mircdirtext\BlackJack.txt) cards left
n168=      bj.dealer.bust
n169=      halt
n170=    }
n171=    if (%bj.hit.user == 3) {
n172=      drawtext -b @BlackJack 8 1 Arial 16 55 120 $gettok(%bj.hit1,2,44) of $gettok(%bj.hit1,3,44)
n173=      drawtext -b @BlackJack 8 1 Arial 16 75 12 You %bj.math.user $space $lines($mircdirtext\BlackJack.txt) cards left
n174=    }
n175=    if (%bj.math.user > %bj.math.dealer) { 
n176=      drawtext -b @BlackJack 8 1 Arial 16 55 100 $gettok(%bj.hit1,2,44) of $gettok(%bj.hit1,3,44)
n177=      drawtext -b @BlackJack 8 1 Arial 16 75 12 You %bj.math.user $space $lines($mircdirtext\BlackJack.txt) cards left
n178=      bj.dealer.bust
n179=      halt
n180=    }
n181=    halt
n182=  }
n183=  if ($1 == deal) {
n184=    if (%bj.round == ON) { halt }
n185=    if (%bj.bet == $null) { bj.reply Please place a bet. (bet <amount>) | halt }
n186=    bj.deal
n187=    halt
n188=  }
n189=  if ($1 == stay) {
n190=    if (%bj.math.dealer > 21) { bj.dealer.bust | halt }
n191=    if (%bj.math.user > 21) { bj.user.bust | halt }
n192=    if (%bj.math.dealer == %bj.math.user) { bj.push | halt }
n193=    if (%bj.math.dealer > %bj.math.user) { bj.user.bust | halt }
n194=    if (%bj.math.dealer < %bj.math.user) { bj.dealer.bust | halt }
n195=    halt
n196=  }
n197=  if ($1 == quit) { blackjack off }
n198=  if ($1 == shuffle) { shuffle | halt }
n199=  bj.reply $upper($1-) is not a valid command.
n200=  bj.reply.delay Valid commands are: bet - deal - hit- stay - shuffle - quit
n201=  halt
n202=}
n203=alias bj.back { drawpic -c @Blackjack 1 1 $mircdirbitmaps\status.bmp }
n204=alias bj.reply { bj.back | drawtext -pb @BlackJack 08 01 Arial 16 13 150 $1- }
n205=alias bj.reply.delay {  .timer 1 1 bj.back |  .timer 1 2 drawtext -pb @BlackJack 08 01 Arial 16 13 150 $1- }
n206=alias bj.title { titlebar @BlackJack $chr(91) $+ $chr(160) $+ Your Winings: %bj.money $+ $chr(160) $+ $chr(93) $chr(91) $+ $chr(160) $+ Current bet: %bj.bet $chr(160) $+ $chr(93) | return }
n207=on 1:CLOSE:@Blackjack:/blackjack off
n208=alias shuffle {
n209=  bj.reply Shuffling the cards
n210=  ;Hearts
n211=  .write -c $mircdirtext\BlackJack.txt Hearts,2
n212=  .write $mircdirtext\BlackJack.txt Hearts,3
n213=  .write $mircdirtext\BlackJack.txt Hearts,4
n214=  .write $mircdirtext\BlackJack.txt Hearts,5
n215=  .write $mircdirtext\BlackJack.txt Hearts,6
n216=  .write $mircdirtext\BlackJack.txt Hearts,7
n217=  .write $mircdirtext\BlackJack.txt Hearts,8
n218=  .write $mircdirtext\BlackJack.txt Hearts,9
n219=  .write $mircdirtext\BlackJack.txt Hearts,10
n220=  .write $mircdirtext\BlackJack.txt Hearts,Jack
n221=  .write $mircdirtext\BlackJack.txt Hearts,Queen
n222=  .write $mircdirtext\BlackJack.txt Hearts,King
n223=  .write $mircdirtext\BlackJack.txt Hearts,Ace
n224=  ;Clubs
n225=  .write $mircdirtext\BlackJack.txt Clubs,2
n226=  .write $mircdirtext\BlackJack.txt Clubs,3
n227=  .write $mircdirtext\BlackJack.txt Clubs,4
n228=  .write $mircdirtext\BlackJack.txt Clubs,5
n229=  .write $mircdirtext\BlackJack.txt Clubs,6
n230=  .write $mircdirtext\BlackJack.txt Clubs,7
n231=  .write $mircdirtext\BlackJack.txt Clubs,8
n232=  .write $mircdirtext\BlackJack.txt Clubs,9
n233=  .write $mircdirtext\BlackJack.txt Clubs,10
n234=  .write $mircdirtext\BlackJack.txt Clubs,Jack
n235=  .write $mircdirtext\BlackJack.txt Clubs,Queen
n236=  .write $mircdirtext\BlackJack.txt Clubs,King
n237=  .write $mircdirtext\BlackJack.txt Clubs,Ace
n238=  ;Diamonds
n239=  .write $mircdirtext\BlackJack.txt Diamonds,2
n240=  .write $mircdirtext\BlackJack.txt Diamonds,3
n241=  .write $mircdirtext\BlackJack.txt Diamonds,4
n242=  .write $mircdirtext\BlackJack.txt Diamonds,5
n243=  .write $mircdirtext\BlackJack.txt Diamonds,6
n244=  .write $mircdirtext\BlackJack.txt Diamonds,7
n245=  .write $mircdirtext\BlackJack.txt Diamonds,8
n246=  .write $mircdirtext\BlackJack.txt Diamonds,9
n247=  .write $mircdirtext\BlackJack.txt Diamonds,10
n248=  .write $mircdirtext\BlackJack.txt Diamonds,Jack
n249=  .write $mircdirtext\BlackJack.txt Diamonds,Queen
n250=  .write $mircdirtext\BlackJack.txt Diamonds,King
n251=  .write $mircdirtext\BlackJack.txt Diamonds,Ace
n252=  ;Spades
n253=  .write $mircdirtext\BlackJack.txt Spades,2
n254=  .write $mircdirtext\BlackJack.txt Spades,3
n255=  .write $mircdirtext\BlackJack.txt Spades,4
n256=  .write $mircdirtext\BlackJack.txt Spades,5
n257=  .write $mircdirtext\BlackJack.txt Spades,6
n258=  .write $mircdirtext\BlackJack.txt Spades,7
n259=  .write $mircdirtext\BlackJack.txt Spades,8
n260=  .write $mircdirtext\BlackJack.txt Spades,9
n261=  .write $mircdirtext\BlackJack.txt Spades,10
n262=  .write $mircdirtext\BlackJack.txt Spades,Jack
n263=  .write $mircdirtext\BlackJack.txt Spades,Queen
n264=  .write $mircdirtext\BlackJack.txt Spades,King
n265=  .write $mircdirtext\BlackJack.txt Spades,Ace
n266=  return
n267=}
n268=menu @bj {
n269=  Quit game:blackjack off
n270=}
